import{s as q,e as x,n as S,h as T,b as xe,k as ye,r as ke,d as Y}from"./utils.js";import{q as ee,H as te,r as se,g as h,u as re,d as l,v as j,i as I,e as de,b as m,s as O,k as Ee,f as _,B as ue,c as V,l as Ce,h as f,w as d,y as Z,m as Be,x as Se,L as fe}from"./scheduler.js";import{g as ae,f as he}from"./index2.js";import{S as J,i as X,a as U,g as Ie,t as $,c as De,b as Ne,d as Oe,m as Ve,p as me,e as Te}from"./index.js";import{b as je,c as _e,X as Ae,f as Pe}from"./ConfirmDialog.js";import{w as Me}from"./index3.js";let Re={serverAvailable:!0,rssi:{rssi:0,disconnected:!0},battery:{soc:100,charging:!1},download_ota:{status:"none",progress:0,error:""}};function ze(){const{subscribe:r,set:e,update:t}=Me(Re);return{subscribe:r,setRSSI:s=>{isNaN(Number(s))?t(n=>({...n,rssi:{rssi:0,disconnected:!0}})):t(n=>({...n,rssi:{rssi:Number(s),disconnected:!1}}))},setBattery:s=>{const n=JSON.parse(s);t(o=>({...o,battery:{soc:n.soc,charging:n.charging}}))},setDownloadOTA:s=>{const n=JSON.parse(s);t(o=>({...o,download_ota:{status:n.status,progress:n.progress,error:n.error}}))}}}const H=ze();function Ge(r){let e,t,s='<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0m7-2l4 4m0-4l-4 4"/>',n=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},r[0]],o={};for(let a=0;a<n.length;a+=1)o=x(o,n[a]);return{c(){e=ee("svg"),t=new te(!0),this.h()},l(a){e=se(a,"svg",{viewBox:!0,width:!0,height:!0});var i=h(e);t=re(i,!0),i.forEach(l),this.h()},h(){t.a=null,j(e,o)},m(a,i){I(a,e,i),t.m(s,e)},p(a,[i]){j(e,o=ae(n,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},i&1&&a[0]]))},i:S,o:S,d(a){a&&l(e)}}}function He(r,e,t){return r.$$set=s=>{t(0,e=x(x({},e),T(s)))},e=T(e),[e]}class nt extends J{constructor(e){super(),X(this,e,He,Ge,q,{})}}function Ue(r){let e,t,s='<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2c2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2a4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6c-.6.6-.6 1.2-.5 2V21"/>',n=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},r[0]],o={};for(let a=0;a<n.length;a+=1)o=x(o,n[a]);return{c(){e=ee("svg"),t=new te(!0),this.h()},l(a){e=se(a,"svg",{viewBox:!0,width:!0,height:!0});var i=h(e);t=re(i,!0),i.forEach(l),this.h()},h(){t.a=null,j(e,o)},m(a,i){I(a,e,i),t.m(s,e)},p(a,[i]){j(e,o=ae(n,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},i&1&&a[0]]))},i:S,o:S,d(a){a&&l(e)}}}function qe(r,e,t){return r.$$set=s=>{t(0,e=x(x({},e),T(s)))},e=T(e),[e]}class ot extends J{constructor(e){super(),X(this,e,qe,Ue,q,{})}}function Je(r){let e,t,s='<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 18a3.5 3.5 0 0 0 0-7h-1A5 4.5 0 0 0 7 9a4.6 4.4 0 0 0-2.1 8.4M12 13v9m-3-3l3 3l3-3"/>',n=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},r[0]],o={};for(let a=0;a<n.length;a+=1)o=x(o,n[a]);return{c(){e=ee("svg"),t=new te(!0),this.h()},l(a){e=se(a,"svg",{viewBox:!0,width:!0,height:!0});var i=h(e);t=re(i,!0),i.forEach(l),this.h()},h(){t.a=null,j(e,o)},m(a,i){I(a,e,i),t.m(s,e)},p(a,[i]){j(e,o=ae(n,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},i&1&&a[0]]))},i:S,o:S,d(a){a&&l(e)}}}function Xe(r,e,t){return r.$$set=s=>{t(0,e=x(x({},e),T(s)))},e=T(e),[e]}class it extends J{constructor(e){super(),X(this,e,Xe,Je,q,{})}}function ge(r){let e,t,s,n="Updating Firmware",o,a,i,y,g,D,u,M,F,A,L,k,P,W,v,C,N,ne="Close",E,B,K,oe;function ie(c,b){return c[1].download_ota.status=="progress"?Le:Fe}let R=ie(r),p=R(r);return C=new Ae({props:{class:"mr-2 h-5 w-5"}}),{c(){e=m("div"),t=m("div"),s=m("h2"),s.textContent=n,o=O(),a=m("div"),i=O(),y=m("div"),g=m("div"),p.c(),D=O(),u=m("p"),M=Ee(r[4]),F=O(),A=m("div"),L=O(),k=m("div"),P=m("div"),W=O(),v=m("button"),Ne(C.$$.fragment),N=m("span"),N.textContent=ne,this.h()},l(c){e=_(c,"DIV",{role:!0,class:!0});var b=h(e);t=_(b,"DIV",{class:!0});var w=h(t);s=_(w,"H2",{class:!0,"data-svelte-h":!0}),ue(s)!=="svelte-1xr5sfu"&&(s.textContent=n),o=V(w),a=_(w,"DIV",{class:!0}),h(a).forEach(l),i=V(w),y=_(w,"DIV",{class:!0});var le=h(y);g=_(le,"DIV",{class:!0});var z=h(g);p.l(z),D=V(z),u=_(z,"P",{class:!0});var ce=h(u);M=Ce(ce,r[4]),ce.forEach(l),z.forEach(l),le.forEach(l),F=V(w),A=_(w,"DIV",{class:!0}),h(A).forEach(l),L=V(w),k=_(w,"DIV",{class:!0});var G=h(k);P=_(G,"DIV",{class:!0}),h(P).forEach(l),W=V(G),v=_(G,"BUTTON",{class:!0});var Q=h(v);Oe(C.$$.fragment,Q),N=_(Q,"SPAN",{"data-svelte-h":!0}),ue(N)!=="svelte-hkb09m"&&(N.textContent=ne),Q.forEach(l),G.forEach(l),w.forEach(l),b.forEach(l),this.h()},h(){f(s,"class","text-base-content text-start text-2xl font-bold"),f(a,"class","divider my-2"),f(u,"class","mt-8 text-2xl"),f(g,"class","bg-base-100 flex flex-col items-center justify-center p-6"),f(y,"class","overflow-y-auto"),f(A,"class","divider my-2"),f(P,"class","flex-grow"),f(v,"class","btn btn-warning text-warning-content inline-flex flex-none items-center"),v.disabled=r[2],f(k,"class","flex flex-wrap justify-end gap-2"),f(t,"class","bg-base-100 shadow-secondary/30 rounded-box pointer-events-auto flex max-h-full min-w-fit max-w-md flex-col justify-between p-4 shadow-lg"),f(e,"role","dialog"),f(e,"class","pointer-events-none fixed inset-0 z-50 flex items-center justify-center")},m(c,b){I(c,e,b),d(e,t),d(t,s),d(t,o),d(t,a),d(t,i),d(t,y),d(y,g),p.m(g,null),d(g,D),d(g,u),d(u,M),d(t,F),d(t,A),d(t,L),d(t,k),d(k,P),d(k,W),d(k,v),Ve(C,v,null),d(v,N),B=!0,K||(oe=[Z(v,"click",r[7]),Z(e,"introstart",r[5]),Z(e,"outroend",r[6]),ye(Pe.call(null,e))],K=!0)},p(c,b){R===(R=ie(c))&&p?p.p(c,b):(p.d(1),p=R(c),p&&(p.c(),p.m(g,D))),(!B||b&16)&&Be(M,c[4]),(!B||b&4)&&(v.disabled=c[2])},i(c){B||(U(C.$$.fragment,c),c&&Se(()=>{B&&(E||(E=me(e,he,{y:50},!0)),E.run(1))}),B=!0)},o(c){$(C.$$.fragment,c),c&&(E||(E=me(e,he,{y:50},!1)),E.run(0)),B=!1},d(c){c&&l(e),p.d(),Te(C),c&&E&&E.end(),K=!1,ke(oe)}}}function Fe(r){let e;return{c(){e=m("progress"),this.h()},l(t){e=_(t,"PROGRESS",{class:!0}),h(e).forEach(l),this.h()},h(){f(e,"class","progress progress-primary w-56")},m(t,s){I(t,e,s)},p:S,d(t){t&&l(e)}}}function Le(r){let e;return{c(){e=m("progress"),this.h()},l(t){e=_(t,"PROGRESS",{class:!0,max:!0}),h(e).forEach(l),this.h()},h(){f(e,"class","progress progress-primary w-56"),e.value=r[3],f(e,"max","100")},m(t,s){I(t,e,s)},p(t,s){s&8&&(e.value=t[3])},d(t){t&&l(e)}}}function We(r){let e,t,s=r[0]&&ge(r);return{c(){s&&s.c(),e=de()},l(n){s&&s.l(n),e=de()},m(n,o){s&&s.m(n,o),I(n,e,o),t=!0},p(n,[o]){n[0]?s?(s.p(n,o),o&1&&U(s,1)):(s=ge(n),s.c(),U(s,1),s.m(e.parentNode,e)):s&&(Ie(),$(s,1,1,()=>{s=null}),De())},i(n){t||(U(s),t=!0)},o(n){$(s),t=!1},d(n){n&&l(e),s&&s.d(n)}}}function Ke(r,e,t){let s;xe(r,H,u=>t(1,s=u));let{isOpen:n}=e,o=!0,a=0,i="Preparing ...";je(()=>o?!1:(Y(H,s.download_ota.status="idle",s),Y(H,s.download_ota.error="",s),Y(H,s.download_ota.progress=0,s),!0));function y(u){fe.call(this,r,u)}function g(u){fe.call(this,r,u)}const D=()=>{_e(),location.reload()};return r.$$set=u=>{"isOpen"in u&&t(0,n=u.isOpen)},r.$$.update=()=>{r.$$.dirty&2&&s.download_ota.status=="progress"&&t(3,a=s.download_ota.progress),r.$$.dirty&2&&s.download_ota.status=="error"&&t(2,o=!1),r.$$.dirty&2&&(s.download_ota.status=="progress"?t(4,i="Downloading ..."):s.download_ota.status=="error"?t(4,i=s.download_ota.error):s.download_ota.status=="finished"&&(t(4,i="Restarting ..."),t(3,a=0),setTimeout(()=>{_e(),location.reload()},5e3)))},[n,s,o,a,i,y,g,D]}class lt extends J{constructor(e){super(),X(this,e,Ke,We,q,{isOpen:0})}}const Qe=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,pe=r=>{if(typeof r!="string")throw new TypeError("Invalid argument expected string");const e=r.match(Qe);if(!e)throw new Error(`Invalid argument not valid semver ('${r}' received)`);return e.shift(),e},ve=r=>r==="*"||r==="x"||r==="X",we=r=>{const e=parseInt(r,10);return isNaN(e)?r:e},Ye=(r,e)=>typeof r!=typeof e?[String(r),String(e)]:[r,e],Ze=(r,e)=>{if(ve(r)||ve(e))return 0;const[t,s]=Ye(we(r),we(e));return t>s?1:t<s?-1:0},be=(r,e)=>{for(let t=0;t<Math.max(r.length,e.length);t++){const s=Ze(r[t]||"0",e[t]||"0");if(s!==0)return s}return 0},ct=(r,e)=>{const t=pe(r),s=pe(e),n=t.pop(),o=s.pop(),a=be(t,s);return a!==0?a:n&&o?be(n.split("."),o.split(".")):n||o?n?-1:1:0};export{ot as B,nt as C,lt as G,it as a,ct as c,H as t};
