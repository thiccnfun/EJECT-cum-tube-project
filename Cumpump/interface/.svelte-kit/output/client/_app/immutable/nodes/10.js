import{s as z,e as N,n as B,h as q,b as V,r as Te}from"../chunks/utils.js";import{q as we,H as be,r as $e,g as x,u as ve,d,v as X,i as D,b as w,s as P,f as b,c as G,B as H,h,w as p,y as K,e as se,x as Be,A as Ae,k as ie,l as oe}from"../chunks/scheduler.js";import{S as O,i as L,b as A,d as S,m as M,a as g,t as $,e as U,g as J,c as Y,p as ce}from"../chunks/index.js";import{o as Q,X as ke,a as Se,C as ye,c as Me}from"../chunks/ConfirmDialog.js";import{g as xe,u as W,c as ue,s as fe}from"../chunks/index2.js";import{p as Z}from"../chunks/stores.js";import{S as Ce}from"../chunks/SettingsCard.js";import{A as Ue}from"../chunks/alert-triangle.js";import{h as Fe,u as Ie}from"../chunks/await_block.js";import{e as de}from"../chunks/each.js";import{S as Pe}from"../chunks/Spinner.js";import{B as Ge,a as Ee,G as je,C as Ne,c as R}from"../chunks/compareVersions.js";const Ve=async()=>({title:"Firmware Update"}),kt=Object.freeze(Object.defineProperty({__proto__:null,load:Ve},Symbol.toStringTag,{value:"Module"}));function ze(i){let e,r,t='<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2zm-5-10v6"/><path d="M9.5 13.5L12 11l2.5 2.5"/></g>',a=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},i[0]],s={};for(let l=0;l<a.length;l+=1)s=N(s,a[l]);return{c(){e=we("svg"),r=new be(!0),this.h()},l(l){e=$e(l,"svg",{viewBox:!0,width:!0,height:!0});var n=x(e);r=ve(n,!0),n.forEach(d),this.h()},h(){r.a=null,X(e,s)},m(l,n){D(l,e,n),r.m(t,e)},p(l,[n]){X(e,s=xe(a,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},n&1&&l[0]]))},i:B,o:B,d(l){l&&d(e)}}}function He(i,e,r){return i.$$set=t=>{r(0,e=N(N({},e),q(t)))},e=q(e),[e]}class De extends O{constructor(e){super(),L(this,e,He,ze,z,{})}}function Oe(i){let e,r,t,a,s="Uploading a new firmware (.bin) file will replace the existing firmware.",l,n,c,u,k;return r=new Ue({props:{class:"h-6 w-6 flex-shrink-0"}}),{c(){e=w("div"),A(r.$$.fragment),t=P(),a=w("span"),a.textContent=s,l=P(),n=w("input"),this.h()},l(o){e=b(o,"DIV",{class:!0});var y=x(e);S(r.$$.fragment,y),t=G(y),a=b(y,"SPAN",{"data-svelte-h":!0}),H(a)!=="svelte-14hj7zc"&&(a.textContent=s),y.forEach(d),l=G(o),n=b(o,"INPUT",{type:!0,id:!0,class:!0,accept:!0}),this.h()},h(){h(e,"class","alert alert-warning shadow-lg"),h(n,"type","file"),h(n,"id","binFile"),h(n,"class","file-input file-input-bordered file-input-secondary mt-4 w-full"),h(n,"accept",".bin")},m(o,y){D(o,e,y),M(r,e,null),p(e,t),p(e,a),D(o,l,y),D(o,n,y),c=!0,u||(k=[K(n,"change",i[2]),K(n,"change",i[1])],u=!0)},p:B,i(o){c||(g(r.$$.fragment,o),c=!0)},o(o){$(r.$$.fragment,o),c=!1},d(o){o&&(d(e),d(l),d(n)),U(r),u=!1,Te(k)}}}function Le(i){let e,r;return e=new De({props:{slot:"icon",class:"lex-shrink-0 mr-2 h-6 w-6 self-end rounded-full"}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p:B,i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){U(e,t)}}}function Re(i){let e,r="Upload Firmware";return{c(){e=w("span"),e.textContent=r,this.h()},l(t){e=b(t,"SPAN",{slot:!0,"data-svelte-h":!0}),H(e)!=="svelte-18zv7sf"&&(e.textContent=r),this.h()},h(){h(e,"slot","title")},m(t,a){D(t,e,a)},p:B,d(t){t&&d(e)}}}function qe(i){let e,r;return e=new Ce({props:{collapsible:!1,$$slots:{title:[Re],icon:[Le],default:[Oe]},$$scope:{ctx:i}}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p(t,[a]){const s={};a&65&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){U(e,t)}}}function Xe(i,e,r){let t,a;V(i,W,u=>r(3,t=u)),V(i,Z,u=>r(4,a=u));let s;async function l(){try{const u=new FormData;u.append("file",s[0]);const o=await(await fetch("/rest/uploadFirmware",{method:"POST",headers:{Authorization:a.data.features.security?"Bearer "+t.bearer_token:"Basic"},body:u})).json()}catch(u){console.error("Error:",u)}}function n(){Q(ye,{title:"Confirm Flashing the Device",message:"Are you sure you want to overwrite the existing firmware with a new one?",labels:{cancel:{label:"Abort",icon:ke},confirm:{label:"Upload",icon:De}},onConfirm:()=>{Se(),l()}})}function c(){s=this.files,r(0,s)}return[s,n,c]}class Je extends O{constructor(e){super(),L(this,e,Xe,qe,z,{})}}function Ye(i){let e,r,t='<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 8.04L7.878 20.164a2.857 2.857 0 1 1-4.041-4.04L15.959 4M7 13h8m4 2l1.5 1.6a2 2 0 1 1-3 0L19 15zM15 3l6 6"/>',a=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},i[0]],s={};for(let l=0;l<a.length;l+=1)s=N(s,a[l]);return{c(){e=we("svg"),r=new be(!0),this.h()},l(l){e=$e(l,"svg",{viewBox:!0,width:!0,height:!0});var n=x(e);r=ve(n,!0),n.forEach(d),this.h()},h(){r.a=null,X(e,s)},m(l,n){D(l,e,n),r.m(t,e)},p(l,[n]){X(e,s=xe(a,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},n&1&&l[0]]))},i:B,o:B,d(l){l&&d(e)}}}function Ke(i,e,r){return i.$$set=t=>{r(0,e=N(N({},e),q(t)))},e=q(e),[e]}class Qe extends O{constructor(e){super(),L(this,e,Ke,Ye,z,{})}}function me(i,e,r){const t=i.slice();return t[7]=e[r],t}function We(i){let e,r,t,a,s="Please connect to a network with internet access to perform a firmware update.",l;return r=new Ne({props:{class:"h-6 w-6 flex-shrink-0"}}),{c(){e=w("div"),A(r.$$.fragment),t=P(),a=w("span"),a.textContent=s,this.h()},l(n){e=b(n,"DIV",{class:!0});var c=x(e);S(r.$$.fragment,c),t=G(c),a=b(c,"SPAN",{"data-svelte-h":!0}),H(a)!=="svelte-1x97k7m"&&(a.textContent=s),c.forEach(d),this.h()},h(){h(e,"class","alert alert-error shadow-lg")},m(n,c){D(n,e,c),M(r,e,null),p(e,t),p(e,a),l=!0},p:B,i(n){l||(g(r.$$.fragment,n),l=!0)},o(n){$(r.$$.fragment,n),l=!1},d(n){n&&d(e),U(r)}}}function Ze(i){let e,r,t,a,s='<tr class="font-bold"><th align="left">Release</th> <th align="center" class="hidden sm:block">Release Date</th> <th align="center">Experimental</th> <th align="center">Install</th></tr>',l,n,c,u,k=de(i[6]),o=[];for(let f=0;f<k.length;f+=1)o[f]=ge(me(i,k,f));const y=f=>$(o[f],1,1,()=>{o[f]=null});return{c(){e=w("div"),r=w("div"),t=w("table"),a=w("thead"),a.innerHTML=s,l=P(),n=w("tbody");for(let f=0;f<o.length;f+=1)o[f].c();this.h()},l(f){e=b(f,"DIV",{class:!0});var _=x(e);r=b(_,"DIV",{class:!0});var m=x(r);t=b(m,"TABLE",{class:!0});var T=x(t);a=b(T,"THEAD",{"data-svelte-h":!0}),H(a)!=="svelte-yq4ktl"&&(a.innerHTML=s),l=G(T),n=b(T,"TBODY",{});var j=x(n);for(let I=0;I<o.length;I+=1)o[I].l(j);j.forEach(d),T.forEach(d),m.forEach(d),_.forEach(d),this.h()},h(){h(t,"class","table w-full table-auto"),h(r,"class","overflow-x-auto"),h(e,"class","relative w-full overflow-visible")},m(f,_){D(f,e,_),p(e,r),p(r,t),p(t,a),p(t,l),p(t,n);for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(n,null);u=!0},p(f,_){if(_&7){k=de(f[6]);let m;for(m=0;m<k.length;m+=1){const T=me(f,k,m);o[m]?(o[m].p(T,_),g(o[m],1)):(o[m]=ge(T),o[m].c(),g(o[m],1),o[m].m(n,null))}for(J(),m=k.length;m<o.length;m+=1)y(m);Y()}},i(f){if(!u){for(let _=0;_<k.length;_+=1)g(o[_]);f&&Be(()=>{u&&(c||(c=ce(r,fe,{duration:300,easing:ue},!0)),c.run(1))}),u=!0}},o(f){o=o.filter(Boolean);for(let _=0;_<o.length;_+=1)$(o[_]);f&&(c||(c=ce(r,fe,{duration:300,easing:ue},!1)),c.run(0)),u=!1},d(f){f&&d(e),Ae(o,f),f&&c&&c.end()}}}function et(i){let e,r;return e=new Qe({props:{class:"text-accent h-5 w-5"}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){U(e,t)}}}function he(i){let e,r,t,a,s;r=new Ee({props:{class:"text-secondary h-6 w-6"}});function l(){return i[3](i[7])}return{c(){e=w("button"),A(r.$$.fragment),this.h()},l(n){e=b(n,"BUTTON",{class:!0});var c=x(e);S(r.$$.fragment,c),c.forEach(d),this.h()},h(){h(e,"class","btn btn-ghost btn-circle btn-sm")},m(n,c){D(n,e,c),M(r,e,null),t=!0,a||(s=K(e,"click",l),a=!0)},p(n,c){i=n},i(n){t||(g(r.$$.fragment,n),t=!0)},o(n){$(r.$$.fragment,n),t=!1},d(n){n&&d(e),U(r),a=!1,s()}}}function ge(i){let e,r,t,a=i[7].name+"",s,l,n,c,u=new Intl.DateTimeFormat("en-GB",{dateStyle:"medium"}).format(new Date(i[7].published_at))+"",k,o,y,f,_,m=R(i[0].data.features.firmware_version,i[7].tag_name)!=0,T,j,I,F=i[7].prerelease&&et(),v=m&&he(i);return{c(){e=w("tr"),r=w("td"),t=w("a"),s=ie(a),l=P(),n=w("td"),c=w("div"),k=ie(u),o=P(),y=w("td"),F&&F.c(),f=P(),_=w("td"),v&&v.c(),T=P(),this.h()},l(E){e=b(E,"TR",{class:!0});var C=x(e);r=b(C,"TD",{align:!0,class:!0});var ee=x(r);t=b(ee,"A",{href:!0,class:!0,target:!0,rel:!0});var te=x(t);s=oe(te,a),te.forEach(d),ee.forEach(d),l=G(C),n=b(C,"TD",{align:!0,class:!0});var re=x(n);c=b(re,"DIV",{class:!0});var ae=x(c);k=oe(ae,u),ae.forEach(d),re.forEach(d),o=G(C),y=b(C,"TD",{align:!0});var ne=x(y);F&&F.l(ne),ne.forEach(d),f=G(C),_=b(C,"TD",{align:!0});var le=x(_);v&&v.l(le),le.forEach(d),T=G(C),C.forEach(d),this.h()},h(){h(t,"href",i[7].html_url),h(t,"class","link link-hover"),h(t,"target","_blank"),h(t,"rel","noopener noreferrer"),h(r,"align","left"),h(r,"class","text-base font-semibold"),h(c,"class","my-2"),h(n,"align","center"),h(n,"class","hidden min-h-full align-middle sm:block"),h(y,"align","center"),h(_,"align","center"),h(e,"class",j=R(i[0].data.features.firmware_version,i[7].tag_name)===0?"bg-primary text-primary-content":"bg-base-100 h-14")},m(E,C){D(E,e,C),p(e,r),p(r,t),p(t,s),p(e,l),p(e,n),p(n,c),p(c,k),p(e,o),p(e,y),F&&F.m(y,null),p(e,f),p(e,_),v&&v.m(_,null),p(e,T),I=!0},p(E,C){C&1&&(m=R(E[0].data.features.firmware_version,E[7].tag_name)!=0),m?v?(v.p(E,C),C&1&&g(v,1)):(v=he(E),v.c(),g(v,1),v.m(_,null)):v&&(J(),$(v,1,1,()=>{v=null}),Y()),(!I||C&1&&j!==(j=R(E[0].data.features.firmware_version,E[7].tag_name)===0?"bg-primary text-primary-content":"bg-base-100 h-14"))&&h(e,"class",j)},i(E){I||(g(F),g(v),I=!0)},o(E){$(F),$(v),I=!1},d(E){E&&d(e),F&&F.d(),v&&v.d()}}}function tt(i){let e,r;return e=new Pe({}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p:B,i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){U(e,t)}}}function rt(i){let e,r,t={ctx:i,current:null,token:null,hasCatch:!0,pending:tt,then:Ze,catch:We,value:6,error:10,blocks:[,,,]};return Fe(i[1](),t),{c(){e=se(),t.block.c()},l(a){e=se(),t.block.l(a)},m(a,s){D(a,e,s),t.block.m(a,t.anchor=s),t.mount=()=>e.parentNode,t.anchor=e,r=!0},p(a,s){i=a,Ie(t,i,s)},i(a){r||(g(t.block),r=!0)},o(a){for(let s=0;s<3;s+=1){const l=t.blocks[s];$(l)}r=!1},d(a){a&&d(e),t.block.d(a),t.token=null,t=null}}}function at(i){let e,r;return e=new Ge({props:{slot:"icon",class:"lex-shrink-0 mr-2 h-6 w-6 self-end rounded-full"}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p:B,i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){U(e,t)}}}function nt(i){let e,r="Github Firmware Manager";return{c(){e=w("span"),e.textContent=r,this.h()},l(t){e=b(t,"SPAN",{slot:!0,"data-svelte-h":!0}),H(e)!=="svelte-1iezg3y"&&(e.textContent=r),this.h()},h(){h(e,"slot","title")},m(t,a){D(t,e,a)},p:B,d(t){t&&d(e)}}}function lt(i){let e,r;return e=new Ce({props:{collapsible:!1,$$slots:{title:[nt],icon:[at],default:[rt]},$$scope:{ctx:i}}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p(t,[a]){const s={};a&2049&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){U(e,t)}}}function st(i,e,r){let t,a;V(i,W,u=>r(4,t=u)),V(i,Z,u=>r(0,a=u));async function s(){try{return await(await fetch("https://api.github.com/repos/"+a.data.github+"/releases",{method:"GET",headers:{accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28"}})).json()}catch(u){console.error("Error:",u)}}async function l(u){try{const k=await fetch("/rest/downloadUpdate",{method:"POST",headers:{Authorization:a.data.features.security?"Bearer "+t.bearer_token:"Basic","Content-Type":"application/json"},body:JSON.stringify({download_url:u})})}catch(k){console.error("Error:",k)}}function n(u){Q(ye,{title:"Confirm flashing new firmware to the device",message:"Are you sure you want to overwrite the existing firmware with a new one?",labels:{cancel:{label:"Abort",icon:ke},confirm:{label:"Update",icon:Ee}},onConfirm:()=>{l(u),Q(je,{onConfirm:()=>Me()})}})}return[a,s,n,u=>n(u.assets[0].browser_download_url)]}class it extends O{constructor(e){super(),L(this,e,st,lt,z,{})}}function _e(i){let e,r;return e=new it({}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){U(e,t)}}}function pe(i){let e,r;return e=new Je({}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){U(e,t)}}}function ot(i){let e,r,t,a=i[0].data.features.download_firmware&&(!i[0].data.features.security||i[1].admin)&&_e(),s=i[0].data.features.upload_firmware&&(!i[0].data.features.security||i[1].admin)&&pe();return{c(){e=w("div"),a&&a.c(),r=P(),s&&s.c(),this.h()},l(l){e=b(l,"DIV",{class:!0});var n=x(e);a&&a.l(n),r=G(n),s&&s.l(n),n.forEach(d),this.h()},h(){h(e,"class","mx-0 my-1 flex flex-col space-y-4 sm:mx-8 sm:my-8")},m(l,n){D(l,e,n),a&&a.m(e,null),p(e,r),s&&s.m(e,null),t=!0},p(l,[n]){l[0].data.features.download_firmware&&(!l[0].data.features.security||l[1].admin)?a?n&3&&g(a,1):(a=_e(),a.c(),g(a,1),a.m(e,r)):a&&(J(),$(a,1,1,()=>{a=null}),Y()),l[0].data.features.upload_firmware&&(!l[0].data.features.security||l[1].admin)?s?n&3&&g(s,1):(s=pe(),s.c(),g(s,1),s.m(e,null)):s&&(J(),$(s,1,1,()=>{s=null}),Y())},i(l){t||(g(a),g(s),t=!0)},o(l){$(a),$(s),t=!1},d(l){l&&d(e),a&&a.d(),s&&s.d()}}}function ct(i,e,r){let t,a;V(i,Z,l=>r(0,t=l)),V(i,W,l=>r(1,a=l));let{data:s}=e;return i.$$set=l=>{"data"in l&&r(2,s=l.data)},[t,a,s]}class yt extends O{constructor(e){super(),L(this,e,ct,ot,z,{data:2})}}export{yt as component,kt as universal};
